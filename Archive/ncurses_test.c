#include <ncurses.h>
#include <stdlib.h>
#include <math.h>

#define PI 3.14159265

int main(int argv, char * argc[]) {
    
    uint32_t arr[271] = {1109, 1091, 1088, 1072, 1053, 1052, 1054, 1050, 1053, 1041, 1022, 1035, 1031, 1025, 1019, 1018, 1016, 1015, 1012, 1018, 1022, 1014, 1011, 1013, 1014, 1018, 1005, 1017, 1013, 1014, 1033, 1203, 1211, 1212, 1048, 1025, 1041, 1049, 1053, 1057, 1065, 1073, 1082, 1089, 1083, 1094, 1102, 1116, 1128, 1140, 1143, 1168, 1175, 1192, 1193, 1218, 1232, 1248, 1261, 1280, 1300, 1317, 1336, 1353, 1383, 1391, 1428, 1454, 1478, 1506, 1529, 1571, 1616, 1656, 1700, 1748, 1765, 1861, 1997, 2051, 2030, 2015, 2040, 2065, 1847, 1824, 1816, 1799, 1782, 1858, 1949, 2050, 4299, 2707, 2689, 2676, 2667, 2656, 2644, 2635, 2628, 2616, 2608, 2596, 2373, 2576, 2584, 2580, 2575, 2572, 2572, 2575, 2575, 2581, 2581, 2582, 2589, 2592, 2596, 2602, 2609, 2620, 2628, 2639, 2648, 2661, 2672, 2686, 2701, 2715, 2732, 2749, 2625, 2411, 2404, 2413, 2398, 2326, 2345, 2482, 2950, 2987, 3022, 3054, 3088, 3124, 3163, 3200, 3240, 3194, 0, 1990, 1933, 1866, 1868, 1841, 1800, 1809, 1809, 1797, 1773, 1745, 1730, 1732, 1721, 1713, 1710, 1717, 1718, 1716, 1699, 1697, 1701, 1690, 1692, 1666, 1672, 1679, 1671, 1671, 1691, 1716, 1560, 1588, 1614, 1640, 1716, 3985, 3970, 3957, 3940, 3932, 3919, 3900, 3885, 3870, 3939, 3921, 3916, 3874, 3953, 6008, 6012, 6010, 6014, 6018, 6020, 6024, 7856, 1769, 1770,    0,    0,    0,    0,   87,  130,  149,  153,  163,  158,  164,  155,  157,  156, 158,  155,  152,  154,  152,  151,  151,  148,  149,  150,  148,  153,  153,  159,  146,  150,  148,  149,  150,  148,  153,  153,  147,  146,  139, 135,  133,  133,  108,   93,    0, 1850, 1820, 3459, 1293, 1291, 1267, 1263, 1250, 1247, 1234, 1227, 1231, 1270, 1330, 1409};
    
    // get largest distance of arr
    int i;
    uint32_t max = 0;
    for(i = 0; i < 271; i++) {
        if(arr[i] > max)
            max = arr[i];
    }
    
    initscr();
    noecho(); // no cursor
    raw();
    
    int yMax, xMax, y_curs, x_curs;
    uint16_t startAng = -45;
    
    getmaxyx(stdscr, yMax, xMax);
    y_curs = max/yMax;
    x_curs = max/xMax;
    
    printw("yMax: %d",yMax);
    move(1,0);
    printw("xMax: %d",xMax);
    move(2,0);
    printw("max: %u",max);
    move(3,0);
    printw("curs x: %d", x_curs);
    move(4,0);
    printw("curs y: %d", y_curs);
    int lidar_y = (yMax / 2);
    int lidar_x = xMax / 2;
    
    int ang = -45;
    int p_lidX = 0, p_lidY = 0;
    
    for(i = 0; i < 271; i++) {
        if(arr[i] == 0)
            continue;
        
        // Convert to lidar cartesian coordinate system
        p_lidX = arr[i] * cos((PI/180)*ang);
        p_lidY = arr[i] * sin((PI/180)*ang);
        move(5,0);
        printw("p_lidX: %d",p_lidX);
        move(6,0);
        printw("p_lidY: %d",p_lidY);
        
        // Change coordinate systems to ncurses
        p_lidX = lidar_x + p_lidX / x_curs;
        p_lidY = lidar_y - (p_lidY / y_curs);
        
        move(p_lidY, p_lidX);
        printw("%d,%d",p_lidX,p_lidY);
        
        ang = ang + 1;
    }
    
    move(lidar_y,lidar_x) ;
    printw("^");
    
    getch();
    endwin();
    
    return 0;
}
